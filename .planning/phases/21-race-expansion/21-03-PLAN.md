---
phase: 21-race-expansion
plan: 03
type: execute
wave: 2
depends_on:
  - "21-01"
files_modified:
  - src/components/CharacterPanel.vue
autonomous: true
requirements:
  - RACE-EXP-04
  - RACE-EXP-05

must_haves:
  truths:
    - "Race info panel in character creation shows both bonuses from the new bonus1Type/bonus2Type system"
    - "Locked races (Dark-Elf, Half-Giant, Cyclops, Satyr) with unlocked=false are completely absent from the character creation race picker"
    - "Bonus display renders human-readable labels (e.g. 'Spell Damage +2' not 'spell_damage +2')"
    - "Races with stat bonuses show stat name (e.g. 'STR +1' not 'stat_str +1')"
  artifacts:
    - path: "src/components/CharacterPanel.vue"
      provides: "Updated race info panel rendering bonus1Type/bonus2Type with labels; unlockedRaces filter excludes unlocked=false races"
      contains: "bonus1Type"
  key_links:
    - from: "src/components/CharacterPanel.vue"
      to: "src/module_bindings/"
      via: "Race type from regenerated bindings no longer has strBonus field — must use bonus1Type/bonus1Value/bonus2Type/bonus2Value"
      pattern: "bonus1Type.*bonus2Type"
---

<objective>
Update CharacterPanel.vue to render race bonuses using the new bonus1Type/bonus1Value/bonus2Type/bonus2Value fields from regenerated client bindings, replacing the old strBonus/dexBonus display.

Purpose: After Plan 01 regenerates bindings, CharacterPanel.vue references non-existent fields (strBonus etc.) and will break. This plan fixes the race info display to show both new bonus types with readable labels.
Output: CharacterPanel.vue renders correct bonus info for all 15 races using the new schema fields. Locked races do not appear in the race picker.
</objective>

<execution_context>
@C:/Users/Dell/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dell/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/21-race-expansion/21-CONTEXT.md
@.planning/phases/21-race-expansion/21-01-SUMMARY.md
@src/components/CharacterPanel.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update CharacterPanel.vue race info panel to display new dual-bonus fields</name>
  <files>src/components/CharacterPanel.vue</files>
  <action>
In `src/components/CharacterPanel.vue`, update the race info panel section.

**Current broken code (around lines 35-41):**
```html
<div :style="styles.subtle">
  <span v-if="selectedRaceRow.strBonus > 0n">STR +{{ selectedRaceRow.strBonus }} </span>
  <span v-if="selectedRaceRow.dexBonus > 0n">DEX +{{ selectedRaceRow.dexBonus }} </span>
  <span v-if="selectedRaceRow.chaBonus > 0n">CHA +{{ selectedRaceRow.chaBonus }} </span>
  <span v-if="selectedRaceRow.wisBonus > 0n">WIS +{{ selectedRaceRow.wisBonus }} </span>
  <span v-if="selectedRaceRow.intBonus > 0n">INT +{{ selectedRaceRow.intBonus }} </span>
</div>
```

**Replace with:**
```html
<div :style="styles.subtle">
  <span>{{ formatRaceBonus(selectedRaceRow.bonus1Type, selectedRaceRow.bonus1Value) }}</span>
  <span> | </span>
  <span>{{ formatRaceBonus(selectedRaceRow.bonus2Type, selectedRaceRow.bonus2Value) }}</span>
</div>
```

**Add `formatRaceBonus` method to the component's script section:**

In the `<script setup>` or methods section (wherever other computed properties/methods live in this component), add:

```typescript
function formatRaceBonus(bonusType: string, bonusValue: bigint): string {
  const v = bonusValue.toString();
  switch (bonusType) {
    case 'stat_str': return `STR +${v}`;
    case 'stat_dex': return `DEX +${v}`;
    case 'stat_int': return `INT +${v}`;
    case 'stat_wis': return `WIS +${v}`;
    case 'stat_cha': return `CHA +${v}`;
    case 'spell_damage': return `Spell Damage +${v}`;
    case 'phys_damage': return `Physical Damage +${v}`;
    case 'max_hp': return `Max HP +${v}`;
    case 'max_mana': return `Max Mana +${v}`;
    case 'mana_regen': return `Mana Regen +${v}`;
    case 'stamina_regen': return `Stamina Regen +${v}`;
    case 'crit_chance': return `Crit Chance +${v}`;
    case 'armor': return `Armor +${v}`;
    case 'dodge': return `Dodge +${v}`;
    default: return `${bonusType} +${v}`;
  }
}
```

**Locked race visibility:** The component must filter out races with `unlocked=false` from the race picker. Verify that a computed property like `unlockedRaces` exists and is used in the template:

```typescript
const unlockedRaces = computed(() => props.races.filter(r => r.unlocked));
```

If it does not exist, add it. The template `v-for="race in unlockedRaces"` must reference it — not the raw `props.races` array. This is what prevents Dark-Elf, Half-Giant, Cyclops, and Satyr from appearing in character creation; the data (unlocked=false) was seeded by Plan 01.

No other changes to CharacterPanel.vue are required — the rest of the component (race tile click, class filtering, form submission) is unaffected by the schema change.
  </action>
  <verify>
1. `npm run type-check` or `npx vue-tsc --noEmit` in the client directory — no TypeScript errors
2. Inspect CharacterPanel.vue: no references to `strBonus`, `dexBonus`, `chaBonus`, `wisBonus`, `intBonus` on Race type
3. The template references `bonus1Type`, `bonus1Value`, `bonus2Type`, `bonus2Value`
4. `formatRaceBonus` function exists and has all 14 case branches
5. `unlockedRaces` computed filters `r => r.unlocked` and is used in the race picker `v-for`
  </verify>
  <done>CharacterPanel.vue renders race bonus info using bonus1Type/bonus2Type fields. formatRaceBonus converts type keys to human-readable labels. unlockedRaces filter is present and excludes locked races. No references to old stat bonus field names. TypeScript compiles clean.</done>
</task>

</tasks>

<verification>
- No TypeScript/Vue errors in CharacterPanel.vue
- Race info panel shows formatted bonus labels (not raw type key strings)
- unlockedRaces filter is present and correct — locked races absent from picker
- Old field names (strBonus etc.) fully removed from template
</verification>

<success_criteria>
- Selecting Human in character creation shows: "CHA +1 | Stamina Regen +1"
- Selecting Eldrin shows: "Spell Damage +2 | Max Mana +10"
- Selecting Ironclad shows: "Physical Damage +2 | Armor +1"
- Locked races (Dark-Elf, Half-Giant, Cyclops, Satyr) do NOT appear in the race picker
- No console errors about missing fields
</success_criteria>

<output>
After completion, create `.planning/phases/21-race-expansion/21-03-SUMMARY.md` using the summary template.
</output>
