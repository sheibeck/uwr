---
phase: 21-race-expansion
plan: 04
type: execute
wave: 3
depends_on:
  - "21-02"
  - "21-03"
files_modified: []
autonomous: false
requirements:
  - RACE-EXP-01
  - RACE-EXP-02
  - RACE-EXP-03
  - RACE-EXP-04
  - RACE-EXP-05

must_haves:
  truths:
    - "15 races visible and selectable (11 unlocked) in character creation"
    - "Locked races absent from character creation until unlocked via /unlockrace"
    - "Both bonuses display correctly in race info panel for every race"
    - "New character with non-stat racial bonus (e.g. Eldrin spell damage) has correct racialSpellDamage on Character row"
    - "Character leveled to even level shows racial bonus stack notification in event log"
    - "/unlockrace Dark-Elf fires world broadcast visible to all players"
    - "Eldrin wizard deals more spell damage per hit than a Human wizard at the same level"
  artifacts:
    - path: "src/module_bindings/"
      provides: "Regenerated client bindings with new Race schema"
  key_links:
    - from: "CharacterPanel.vue"
      to: "Race table"
      via: "unlockedRaces computed filters by r.unlocked"
      pattern: "r.unlocked"
---

<objective>
Human verification of all Phase 21 features: 15 races in character creation, correct bonus display, locked race filtering, character creation with dual bonuses applied, level-up racial bonus stacking with notification, /unlockrace admin command, and confirmation that racial spell/physical damage bonuses actually affect combat output (not just the character row).

Purpose: End-to-end validation that schema, data, backend logic, and frontend UI all work together correctly — including that RACE-EXP-05 bonus pool types are functionally active in combat.
Output: Human confirmation that all 5 RACE-EXP requirements are met.
</objective>

<execution_context>
@C:/Users/Dell/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dell/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/21-race-expansion/21-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Verify all Phase 21 race expansion features end-to-end</name>
  <files></files>
  <action>
Human verifies the complete Phase 21 race expansion:

**Step 1 — Race picker shows 11 unlocked races only (RACE-EXP-01, RACE-EXP-04)**
- Open character creation. Count race tiles — should be exactly 11.
- Present: Human, Eldrin, Ironclad, Wyldfang, Goblin, Troll, Dwarf, Gnome, Halfling, Half-Elf, Orc
- Absent: Dark-Elf, Half-Giant, Cyclops, Satyr

**Step 2 — Bonus labels display correctly in race info panel (RACE-EXP-02, RACE-EXP-05)**
Click each race and verify the info panel shows two human-readable bonus labels:
- Human: "CHA +1 | Stamina Regen +1"
- Eldrin: "Spell Damage +2 | Max Mana +10"
- Ironclad: "Physical Damage +2 | Armor +1"
- Wyldfang: "Crit Chance +5 | DEX +1"
- Goblin: "Spell Damage +1 | Mana Regen +1"
- Troll: "Max HP +15 | Physical Damage +1"
- Dwarf: "Max HP +10 | Physical Damage +2"
- Gnome: "Mana Regen +2 | Max Mana +15"
- Halfling: "Crit Chance +8 | Dodge +8"
- Half-Elf: "STR +1 | INT +1"
- Orc: "Physical Damage +3 | Max HP +8"

**Step 3 — Non-stat racial bonus applied at character creation AND active in combat (RACE-EXP-05)**
- Create a new Eldrin wizard and a new Human wizard (same level 1).
- Eldrin Max Mana should be 10 higher than Human at the same class/level.
- Use `/level <eldrinCharId> 1` and `/level <humanCharId> 1` to confirm they are the same level.
- Have both characters enter combat and fire the same spell ability.
- Check server logs or event log damage numbers: Eldrin's spell hit should be 2 higher than Human's (racialSpellDamage=2 added per hit).
- Alternatively query: `spacetime sql <module> "SELECT name, racialSpellDamage FROM character WHERE name IN ('EldrinChar', 'HumanChar')"` — Eldrin row has racialSpellDamage=2, Human row has NULL.

**Step 4 — Even-level racial bonus stacking with notification (RACE-EXP-03)**
- Use `/level <characterId> 2` on an Eldrin character
- Event log shows: "Your Eldrin heritage deepens at level 2 — racial bonuses strengthen."
- Level to 3 (odd) — no racial notification
- Level to 4 — racial notification fires again

**Step 5 — /unlockrace admin command + world broadcast (RACE-EXP-04)**
- As admin: `/unlockrace Dark-Elf`
- World broadcast fires in event log: "A world-shaking event has occurred — the Dark-Elf have emerged..."
- Navigate to character creation — Dark-Elf tile now appears
- Dark-Elf info panel shows: "Spell Damage +3 | Mana Regen +1"

**Step 6 — Error handling**
- `/unlockrace BogusRace` → private "Race not found" message, no crash
- `/unlockrace Dark-Elf` again → "already unlocked" message

**Step 7 — No console errors**
- Browser devtools console shows no errors about strBonus, dexBonus, or missing fields
  </action>
  <verify>All 7 steps above pass without errors or unexpected behavior.</verify>
  <done>Human confirms all race picker counts, bonus displays, creation stats, Eldrin spell damage higher than Human in combat, level-up notifications, /unlockrace broadcast, and absence of console errors are correct.</done>
</task>

</tasks>

<verification>
All 5 requirements verified by human:
- RACE-EXP-01: 11 new races visible (not 4), all with two distinct bonuses displayed
- RACE-EXP-02: 4 starter races show new dual-bonus display (Spell Damage, Physical Damage, Crit, CHA, etc.)
- RACE-EXP-03: Even-level notification fires; level_character applies racial stack correctly
- RACE-EXP-04: 4 locked races absent until /unlockrace fires with world broadcast
- RACE-EXP-05: Bonus pool represented and ACTIVE: spell damage confirmed higher in combat for Eldrin, phys damage higher for Ironclad; max mana, mana regen, max HP, armor, crit, dodge, stamina regen, stat bonuses all in use across the 15-race roster
</verification>

<success_criteria>
Human confirms "approved" after all 7 steps pass without errors.
</success_criteria>

<output>
After completion, create `.planning/phases/21-race-expansion/21-04-SUMMARY.md` using the summary template.
Update `.planning/STATE.md` to mark Phase 21 as complete.
Update `.planning/ROADMAP.md` Phase 21 section with completed plan checkboxes.
</output>
