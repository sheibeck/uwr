---
phase: 02-hunger
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/composables/useGameData.ts
  - src/composables/useInventory.ts
  - src/components/InventoryPanel.vue
  - src/components/HungerBar.vue
  - src/App.vue
  - src/ui/styles.ts
autonomous: false

must_haves:
  truths:
    - "Hunger bar displays current hunger level as a percentage bar"
    - "Well Fed status shows when active, with time remaining in minutes"
    - "Well Fed buff type and magnitude are visible (e.g. '+2 STR', '+4 Mana Regen')"
    - "Food items in inventory have an Eat button (slot === 'food' items only)"
    - "Clicking Eat calls eat_food reducer and consumes the food item"
    - "Hunger at 0 shows no penalty indicator — just an empty bar"
  artifacts:
    - path: "src/components/HungerBar.vue"
      provides: "Hunger bar UI with current hunger level, Well Fed badge with time remaining and damage bonus"
    - path: "src/composables/useGameData.ts"
      provides: "myHunger table subscription via useTable(tables.myHunger)"
      contains: "useTable(tables.myHunger)"
    - path: "src/composables/useInventory.ts"
      provides: "eatable property on food items for Eat button rendering"
      contains: "eatable"
    - path: "src/App.vue"
      provides: "HungerBar rendered below StatsPanel area, eatFood wired to reducer"
      contains: "HungerBar"
  key_links:
    - from: "src/composables/useGameData.ts"
      to: "src/module_bindings (tables.myHunger)"
      via: "useTable subscription"
      pattern: "useTable\\(tables\\.myHunger\\)"
    - from: "src/App.vue"
      to: "src/module_bindings (reducers.eatFood)"
      via: "useReducer for eat food action"
      pattern: "reducers\\.eatFood"
    - from: "src/components/HungerBar.vue"
      to: "src/App.vue"
      via: "props passing hunger data from myHunger subscription"
      pattern: ":hunger="
---

<objective>
Build the client-side hunger UI: HungerBar component showing current hunger level and Well Fed status, Eat button for food items in inventory, and all wiring through App.vue to the eat_food reducer.

Purpose: Players need to see their hunger state and be able to eat food items to gain the Well Fed buff. This completes the hunger feature end-to-end.
Output: Working HungerBar component, Eat button on food items, full eat_food flow wired.
</objective>

<execution_context>
@C:/Users/Dell/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dell/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-hunger/02-RESEARCH.md
@.planning/phases/02-hunger/02-01-SUMMARY.md
@src/App.vue
@src/composables/useGameData.ts
@src/composables/useInventory.ts
@src/components/InventoryPanel.vue
@src/components/StatsPanel.vue
@src/ui/styles.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: HungerBar component and data subscription</name>
  <files>
    src/components/HungerBar.vue
    src/composables/useGameData.ts
    src/composables/useInventory.ts
  </files>
  <action>
**A. Add myHunger subscription to `src/composables/useGameData.ts`:**

After the existing `useTable` calls (line ~57, after `const [races] = useTable(tables.race);`), add:

```typescript
const [myHunger] = useTable(tables.myHunger);
```

Add `myHunger` to the return object.

**B. Add `eatable` property to inventory items in `src/composables/useInventory.ts`:**

In the `InventoryItem` type (near line 35-44), add:
```typescript
eatable: boolean;
```

In the `inventoryItems` computed (near line 98+), after the `usable` computation (line 140-141), add:
```typescript
const eatable = (template?.slot ?? '').toLowerCase() === 'food';
```

Include `eatable` in the returned item object (near line 142-159).

Return `eatable` alongside existing properties from the composable if needed (check if `InventoryItem` type is used elsewhere — it should just be the interface).

**C. Create `src/components/HungerBar.vue`:**

Vue 3 SFC with `<script setup lang="ts">`. Props:
- `hunger`: `{ currentHunger: bigint; wellFedUntil: { microsSinceUnixEpoch: bigint }; wellFedBuffType: string; wellFedBuffMagnitude: bigint } | null`
- `styles`: `any` (the global styles object)

Computed properties:
- `hungerPercent`: `Number(props.hunger?.currentHunger ?? 0n)` — value 0-100
- `wellFedUntilDate`: Convert timestamp per CLAUDE.md — `new Date(Number(props.hunger.wellFedUntil.microsSinceUnixEpoch / 1000n))`
- `isWellFed`: `wellFedUntilDate > new Date()`
- `timeRemainingMinutes`: `Math.max(0, Math.floor((wellFedUntilDate.getTime() - Date.now()) / 60000))`
- `buffLabel`: A computed string from the buff type and magnitude:
  ```typescript
  const buffLabel = computed(() => {
    if (!props.hunger) return '';
    const mag = Number(props.hunger.wellFedBuffMagnitude);
    switch (props.hunger.wellFedBuffType) {
      case 'str': return `+${mag} STR`;
      case 'dex': return `+${mag} DEX`;
      case 'mana_regen': return `+${mag} Mana Regen`;
      case 'stamina_regen': return `+${mag} Stamina Regen`;
      default: return '';
    }
  });
  ```

Template structure (follow existing component styles pattern from StatsPanel.vue — inline styles via `:style="styles.xxx"`):
- Hunger label: "Hunger: {hungerPercent}/100"
- Progress bar: A div with background color, width set to `hungerPercent`%. Use green for >50, yellow for 20-50, red for <20. No penalty text at 0 (REQ-015).
- Well Fed section (v-if="isWellFed"):
  - "Well Fed" badge with green indicator
  - "{buffLabel}" (e.g. "+2 STR" or "+4 Mana Regen")
  - "{timeRemainingMinutes}m remaining"

Style the progress bar using inline styles consistent with the codebase pattern (styles.ts objects). The bar should be compact — this goes in the side panel area. Use `styles.panel` or `styles.statRow` patterns from existing components.

Keep it simple. This is a display-only component — no user interaction.
  </action>
  <verify>
TypeScript compilation check: `npx vue-tsc --noEmit` (or run `npm run build` if available). Verify HungerBar.vue compiles, useGameData.ts exports myHunger, useInventory.ts includes eatable property on items.
  </verify>
  <done>
HungerBar.vue created with hunger bar, Well Fed badge (damage bonus + time remaining), and no-penalty display at 0. useGameData.ts subscribes to myHunger. useInventory.ts marks food items as eatable.
  </done>
</task>

<task type="auto">
  <name>Task 2: App.vue wiring — HungerBar rendering and Eat button</name>
  <files>
    src/App.vue
    src/components/InventoryPanel.vue
    src/ui/styles.ts
  </files>
  <action>
**A. Import HungerBar in `src/App.vue`:**

Add import near other panel imports (line 547-563):
```typescript
import HungerBar from './components/HungerBar.vue';
```

**B. Extract myHunger from useGameData:**

In App.vue where `useGameData()` is destructured (search for `const { conn, players, myPlayer`), add `myHunger` to the destructured properties.

**C. Compute active hunger row:**

Add a computed property near other character-derived computeds:
```typescript
const activeHunger = computed(() => {
  if (!selectedCharacter.value || !myHunger.value.length) return null;
  return myHunger.value.find(
    (h: any) => h.characterId.toString() === selectedCharacter.value?.id.toString()
  ) ?? null;
});
```

**D. Render HungerBar in template:**

Place HungerBar in the StatsPanel area (line 212-219). After `</StatsPanel>`, add HungerBar as a companion display that shows when the stats panel is active OR as a persistent element when a character is selected. The simplest placement: render it right after the StatsPanel block, visible when `activePanel === 'stats'` and selectedCharacter exists:

```vue
<HungerBar
  v-if="activePanel === 'stats' && selectedCharacter"
  :hunger="activeHunger"
  :styles="styles"
/>
```

Alternatively, if the game has a persistent status area (check template structure), place it there. Follow existing UI patterns.

**E. Add Eat button to `src/components/InventoryPanel.vue`:**

Near the existing "Use" button (line 68-73), add an "Eat" button for food items:

```vue
<button
  v-if="item.eatable"
  :style="styles.primaryButton"
  @click="$emit('eat-food', item.id)"
>
  Eat
</button>
```

Add `'eat-food'` to the component's `defineEmits`. Check existing emits declaration and add the new event.

**F. Wire eat-food event in App.vue:**

1. Add `@eat-food="eatFood"` to the `<InventoryPanel>` element (line 145-162).
2. Create the eatFood reducer reference:
```typescript
const eatFoodReducer = useReducer(reducers.eatFood);
```
3. Create the handler:
```typescript
const eatFood = (itemInstanceId: bigint) => {
  if (!conn.isActive || !selectedCharacter.value) return;
  eatFoodReducer({ characterId: selectedCharacter.value.id, itemInstanceId });
};
```

**G. Add hunger-related styles to `src/ui/styles.ts` if needed:**

Add styles for the hunger bar (progress bar container, fill, Well Fed badge). Follow the existing inline style pattern. Example additions to the styles object:

```typescript
hungerBar: {
  width: '100%',
  height: '14px',
  backgroundColor: '#333',
  borderRadius: '4px',
  overflow: 'hidden',
  marginTop: '4px',
},
hungerFill: {
  height: '100%',
  borderRadius: '4px',
  transition: 'width 0.3s ease',
},
wellFedBadge: {
  display: 'inline-block',
  padding: '2px 8px',
  borderRadius: '4px',
  backgroundColor: '#2a5a2a',
  color: '#7fdf7f',
  fontSize: '11px',
  marginTop: '4px',
},
```
  </action>
  <verify>
Run `npm run dev` (or the project's dev server command). Open the app in browser. Create a character — verify hunger bar appears on stats panel showing 100/100. Craft or obtain a food-slot item (Herb Broth, Roasted Roots, Traveler's Stew, or Forager's Salad). Open inventory — verify "Eat" button appears on food-slot items only (NOT on Simple Rations or other consumables). Click Eat — verify food consumed and Well Fed status appears on hunger bar with the correct buff label (e.g. "+2 STR" for Roasted Roots, "+4 Mana Regen" for Herb Broth) and "45m remaining" (approximately). Wait and verify hunger decays (check after 5+ minutes).
  </verify>
  <done>
HungerBar renders on stats panel showing hunger level and Well Fed status. Food items show Eat button in inventory. Clicking Eat calls eat_food reducer, consumes item, and Well Fed badge appears with damage bonus and time remaining. Hunger bar shows no penalty at 0.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human verification of hunger system end-to-end</name>
  <files>n/a</files>
  <action>
Human verifies the complete hunger system works end-to-end. Everything was built in Plan 01 (backend) and Tasks 1-2 (frontend) — this checkpoint confirms it works visually and functionally.

Steps to verify:
1. Open the application in browser
2. Create a new character
3. Navigate to Stats panel — verify hunger bar shows "100/100" (or similar full display)
4. Verify NO Well Fed badge is shown initially
5. Buy Simple Rations from vendor. Use it — verify it applies a small HoT ("You eat the simple rations and feel a little better"), NOT a Well Fed badge
6. Open inventory — verify Simple Rations has NO "Eat" button (only "Use"), confirming eatable = slot === 'food' only
7. Craft Roasted Roots (2x Root Vegetable + 1x Salt via craft menu). Open inventory — verify "Eat" button appears on Roasted Roots
8. Click "Eat" on Roasted Roots — verify:
   a. Roasted Roots consumed (quantity decremented or removed)
   b. Well Fed badge appears on hunger bar showing "+2 STR" and ~45 minutes remaining
9. Enter combat with an enemy
10. Verify damage dealt appears to include the Well Fed +2 bonus (compare with expected base damage)
11. Wait 5+ minutes — verify hunger has decayed by ~2 points (98/100 or similar)
12. Verify hunger bar at 0 shows no penalty text or negative indicator (REQ-015)

Expected behavior:
- Hunger starts at 100, decays 2 per 5 minutes
- Simple Rations (Use) applies a short HoT, no Well Fed badge
- Crafted food (Eat) shows Well Fed badge with correct buff label (+2 STR, +4 Mana Regen, etc.) and ~45 min remaining
- Combat damage includes Well Fed str/dex flat bonus on both auto-attacks and abilities
- No penalty at hunger 0

Type "approved" to confirm hunger system works correctly, or describe any issues found.
  </action>
  <verify>Human confirms all 12 verification steps pass.</verify>
  <done>Hunger system verified end-to-end: hunger bar, Well Fed buff, Eat button, combat damage bonus, hunger decay, no penalty at 0.</done>
</task>

</tasks>

<verification>
1. HungerBar.vue renders correctly with hunger level and Well Fed status
2. Eat button appears only on food-slot items (not on consumables like Simple Rations)
3. Eating food triggers eat_food reducer, consumes item, shows Well Fed badge with buffLabel and time remaining
4. Well Fed str/dex bonus applies in combat as flat damage; mana_regen/stamina_regen display in badge
5. Hunger decays over time via scheduled tick
6. No penalty at hunger 0
7. Human verified end-to-end flow
</verification>

<success_criteria>
- HungerBar component displays hunger level (0-100) with progress bar
- Well Fed badge shows buff label (e.g. "+2 STR", "+4 Mana Regen") and time remaining when active
- Food-slot items have Eat button in inventory panel; consumable-slot items do not
- Eating food consumes item and activates Well Fed buff with correct buffType/magnitude
- Full reducer wiring: App.vue -> eatFood reducer -> backend eat_food
- Human verification confirms end-to-end hunger system works
</success_criteria>

<output>
After completion, create `.planning/phases/02-hunger/02-02-SUMMARY.md`
</output>
