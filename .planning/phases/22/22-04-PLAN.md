---
plan: 22-04
title: Publish, regenerate bindings, and human verification
phase: 22
status: pending
estimated_tasks: 2
---

# Plan 22-04: Publish, regenerate bindings, and human verification

## Goal
Republish the updated module, regenerate client bindings, and confirm every class's new abilities work correctly in-game through manual testing.

## Prerequisites
- Plan 22-01 (schema foundation)
- Plan 22-02 (ability data files)
- Plan 22-03 (switch cases and new reducers)

## Tasks

### Task 1: Final publish and binding regeneration

**Files:**
- `client/src/module_bindings/` (regenerated, do not edit manually)

**Action:** Do a clean republish to pick up all ability data changes and new reducer, then regenerate TypeScript client bindings.

**Details:**

Step 1 — TypeScript type check before publish to catch any compile errors:
```bash
cd spacetimedb && npx tsc --noEmit 2>&1 | head -50
```
If errors appear, fix them before publishing. Common errors:
- Missing import for `BardSongTick` or `ActiveBardSong` — add to the reducer file's import list
- `addCharacterEffect` not imported in the bard tick reducer file — add import from `../helpers/combat`
- `ScheduleAt` not imported — add `import { ScheduleAt } from 'spacetimedb';`
- `recomputeCharacterDerived` not in scope — import from `../helpers/character`

Step 2 — Publish (no --clear-database needed if schema was already cleared in Plan 22-01, but use it if module was changed significantly):
```bash
spacetime publish uwr --project-path spacetimedb
```

If you get schema mismatch errors, use:
```bash
spacetime publish uwr --clear-database -y --project-path spacetimedb
```

Step 3 — Regenerate bindings:
```bash
spacetime generate --lang typescript --out-dir client/src/module_bindings --project-path spacetimedb
```

Step 4 — Verify new tables and fields are in bindings:
```bash
grep -rl "ActiveBardSong\|active_bard_song" client/src/module_bindings/
grep -rl "isTemporary\|is_temporary" client/src/module_bindings/
grep -rl "ownerCharacterId\|owner_character_id" client/src/module_bindings/
```
All three commands should return at least one file path.

Step 5 — Check module logs for errors after publish:
```bash
spacetime logs uwr 2>&1 | tail -30
```
No panics, no "unknown ability key" errors, no schema errors.

**Verify:** All three grep commands return file paths. `spacetime logs uwr` shows no errors.

**Done:** Module is live with all Phase 22 changes. Client bindings are current. No runtime errors.

---

### Task 2: Human verification — test all 16 classes in-game

**Action:** Log in with test characters at various levels and verify each class's ability unlock curve and functionality.

**How to verify:**

Use the `/levelup` or debug command to set character level, then open the Abilities panel and test each ability on hotbar.

**Verification checklist — check each row:**

| Class | L1 Ability | L3 Ability | L5 Ability | L7 Ability | L9 Ability | L10 Capstone |
|-------|-----------|-----------|-----------|-----------|-----------|-------------|
| Warrior | Slam (AC debuff fires) | Intimidating Presence (taunt) | Crushing Blow (high dmg) | Cleave (hits all enemies) | Rally (party AC buff) | Berserker Rage (stance) |
| Cleric | Mend (heals ally) | Blessing of Might (party STR) | Heal (big heal) | Sanctify (party AC+regen) | Resurrect (out of combat) | Holy Nova (AoE dmg + heal) |
| Wizard | Magic Missile | Frost Shard (dmg+debuff) | Lightning Surge (2s cast) | Mana Shield (AC buff) | Arcane Storm (AoE) | Arcane Explosion (AoE, 3s cast) |
| Rogue | Shadow Cut (dmg+DoT) | Evasion (AC buff) | Shadow Strike | Bleed (pure DoT) | Pickpocket (utility) | Death Mark (damage_taken debuff) |
| Ranger | Marked Shot (debuff) | Track (scout) | Piercing Arrow | Nature's Balm (HoT) | Rapid Shot (2 hits) | Rain of Arrows (AoE) |
| Druid | Thorn Lash | Nature's Mark (gather) | Wild Surge | Nature's Gift (HoT) | Entangle (AoE DoT) | Shapeshifter Form (stance) |
| Bard | Discordant Note (starts song, ticks AoE dmg) | Melody of Mending (song, heals) | Chorus of Vigor (song, mana) | March of Wayfarers (song, travel) | Battle Hymn (song, dmg+heal+mana) | Finale (burst) |
| Monk | Crippling Kick (dmg+debuff) | Stunning Strike (stun) | Tiger Flurry (3 hits) | Centering (stamina restore) | Inner Focus (damage_up) | Hundred Fists (5 hits) |
| Paladin | Holy Strike (dmg+AC) | Shield of Faith (AC buff) | Radiant Smite (1s cast) | Lay on Hands (full heal) | Devotion (party defense) | Consecrated Ground (AoE DoT + party HoT) |
| Shaman | Spirit Mender (HoT) | Hex (dmg+AC debuff) | Stormcall (2s cast) | Spirit Wolf (pet) | Ancestral Ward (AC shield) | Earthquake (AoE+stun) |
| Necromancer | Plague Spark (DoT) | Bone Servant (tank pet) | Wither (life drain DoT — watch HP go UP) | Soul Rot (DoT+AC debuff) | Corpse Summon (out of combat) | Plague Lord Form (stance) |
| Beastmaster | Call Beast (summons pet) | Pack Rush (2 hits) | Alpha Assault | Wild Howl (damage_up) | Beast Fang (DoT) | Wild Hunt (AoE) |
| Enchanter | Mind Fray (DoT) | Mesmerize (stun) | Clarity (mana regen) | Haste (party haste) | Bewilderment (AoE AC debuff) | Charm (pet copy) |
| Reaver | Blood Rend (dmg+lifesteal) | Soul Rend | Oblivion (1s cast) | Dread Aura (AoE debuff) | Blood Pact (stamina, damage_up) | Death's Embrace (stance) |
| Spellblade | Flame Strike (dmg+DoT) | Frost Armor (AC+shield) | Thunder Cleave (AoE) | Stone Skin (big AC) | Magma Shield (AC+shield) | Elemental Surge (2s cast) |
| Summoner | Earth Elemental (tank pet) | Conjure Sustenance (gives items) | Fire Elemental (DPS pet) | Water Elemental (heal pet) | Conjure Equipment (temp items) | Primal Titan (ultimate pet) |

**Specific mechanics to confirm:**
1. **Bard songs** — Cast Discordant Note in combat, wait 6 seconds, confirm AoE damage tick fires in event log. Cast Melody of Mending, confirm party heals on tick. Cast Finale, confirm immediate burst.
2. **Stun** — Monk Stunning Strike or Enchanter Mesmerize: enemy should skip its turn for 4 rounds (check combat log — enemy does not attack).
3. **Wither life drain** — Watch caster HP increase as Wither DoT ticks.
4. **Conjure Equipment** — After casting, check inventory for `isTemporary` items. Log out. Log back in. Confirm items are gone.
5. **Berserker Rage / Shapeshifter Form / Plague Lord Form / Death's Embrace** — Cast, confirm CharacterEffect appears (check via debug or event log mentioning the stance).
6. **Cleave / AoE abilities** — Confirm damage is applied to ALL enemies in combat, not just one.
7. **Level gates** — On a level 5 character, confirm L7/L9/L10 abilities cannot be used (SenderError: "Ability not unlocked").

**Resume signal:** Type "verified" once all checks pass, or describe any failures with class name and ability name so they can be diagnosed.

**Verify:** All 16 classes have working abilities at each unlock level. No abilities silently consume resources without effect (default case logs "You use X" — if you see this for a valid ability, the switch case is missing).

**Done:** Every class has mechanically distinct, level-gated abilities working in-game. Phase 22 objectives ABILITY-01 through ABILITY-06 are met.

## Verification

Overall phase success criteria:
1. All 16 ability files have exactly 6 abilities each at levels 1n, 3n, 5n, 7n, 9n, 10n
2. Zero abilities at even levels (`grep -rn "level: [024678]n" spacetimedb/src/data/abilities/`)
3. Every ability key in data files has a corresponding switch case in helpers/combat.ts (no "default:" fires for player abilities)
4. BardSongTick scheduler running in production (`spacetime logs uwr` shows no tick errors)
5. Stun effect prevents enemies from acting (combat loop check covers 'stun' || 'skip')
6. Wither heals caster on each DoT tick (ownerCharacterId triggers heal)
7. Temporary items deleted on logout (isTemporary check in character_logout)
8. Human tester confirms all 16 classes functional in-game

## Commit Message
`docs(22-04): publish and verify Phase 22 class ability balancing complete`
