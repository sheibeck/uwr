---
phase: 20-perk-variety-expansion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - spacetimedb/src/data/renown_data.ts
  - src/components/RenownPanel.vue
autonomous: true

must_haves:
  truths:
    - "PerkEffect type supports proc triggers, crafting bonuses, social bonuses, and scaling fields"
    - "Ranks 2-11 each have exactly 3 perks: one combat, one crafting/gathering, one social/utility"
    - "Backend and frontend perk definitions are in sync"
    - "Existing passive stat bonus perks still work unchanged"
    - "Perk descriptions clearly explain what each perk does"
  artifacts:
    - path: "spacetimedb/src/data/renown_data.ts"
      provides: "Extended PerkEffect type and 30 new perk definitions for ranks 2-11"
      contains: "procType"
    - path: "src/components/RenownPanel.vue"
      provides: "Matching client-side perk display data for ranks 2-11"
      contains: "domain"
  key_links:
    - from: "spacetimedb/src/data/renown_data.ts"
      to: "spacetimedb/src/helpers/renown.ts"
      via: "RENOWN_PERK_POOLS import"
      pattern: "RENOWN_PERK_POOLS"
    - from: "src/components/RenownPanel.vue"
      to: "spacetimedb/src/data/renown_data.ts"
      via: "mirrored perk key names"
      pattern: "key:"
---

<objective>
Design and define all 30 perks for ranks 2-11 with the extended PerkEffect type system, covering combat, crafting/gathering, and social/utility domains.

Purpose: Establish the complete perk data foundation that all subsequent implementation plans build upon. No perk logic changes — pure data definitions.
Output: Extended PerkEffect type, 30 fully-defined perks in backend data file, matching display definitions in frontend component.
</objective>

<execution_context>
@C:/Users/Dell/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dell/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@spacetimedb/src/data/renown_data.ts
@src/components/RenownPanel.vue
@spacetimedb/src/helpers/renown.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend PerkEffect type and redesign ranks 2-11 perk definitions</name>
  <files>spacetimedb/src/data/renown_data.ts</files>
  <action>
Extend the `PerkEffect` type to support all new effect categories. Add these optional fields:

**Proc effects:**
- `procType?: 'on_crit' | 'on_hit' | 'on_kill' | 'on_damage_taken'`
- `procChance?: number` (percentage 0-100, user decision: 2-10% range for rare/impactful)
- `procDamageMultiplier?: bigint` (percentage, e.g. 200n = 200% weapon damage)
- `procHealPercent?: number` (heal for X% of damage dealt)
- `procBonusDamage?: bigint` (flat bonus damage on proc)

**Crafting/gathering:**
- `gatherDoubleChance?: number` (percentage chance for 2x yield)
- `gatherSpeedBonus?: number` (percentage faster gathering)
- `craftQualityBonus?: number` (percentage better item stats)
- `rareGatherChance?: number` (percentage chance for rare materials)

**Social/utility:**
- `npcAffinityGainBonus?: number` (percentage bonus to affinity gains)
- `vendorBuyDiscount?: number` (percentage discount on purchases)
- `vendorSellBonus?: number` (percentage better sell prices)
- `travelCooldownReduction?: number` (percentage reduction)
- `goldFindBonus?: number` (percentage bonus gold from all sources)
- `xpBonus?: number` (percentage bonus XP from all sources)

**Scaling:**
- `scalesWithLevel?: boolean` (effect grows with character level)
- `perLevelBonus?: number` (multiplier per character level, e.g. 0.5 = +0.5 per level)

Also add a `domain` field to the `Perk` type: `domain: 'combat' | 'crafting' | 'social'`.

Then redesign RENOWN_PERK_POOLS for ranks 2-11 (leave ranks 12-15 unchanged — those are deferred capstones). Each rank gets exactly 3 perks: one combat, one crafting, one social/utility.

**Design rules (from user decisions):**
- 3 options per rank, one from each domain
- Tier 1 (ranks 2-3): Simple, single-effect perks
- Tier 2 (ranks 4-6): Moderate effects, introduce first procs and crafting bonuses
- Tier 3 (ranks 7-9): Multi-part effects, scaling perks, active abilities
- Tier 4 (ranks 10-11): Powerful effects, complex interactions
- Power jumps at tier boundaries, similar power within a tier
- Proc chances 2-10%, rare and impactful
- Soft synergies between perks (two procs stack, but no hard prerequisites)
- Match Shadeslinger fantasy tone for names

**Perk design for ranks 2-11 (30 perks total):**

Rank 2 (Tier 1 - simple):
- Combat: "Iron Will" - +25 max HP, +1 STR (straightforward toughness)
- Crafting: "Keen Eye" - 10% chance to gather double resources
- Social: "Smooth Talker" - +15% NPC affinity gain from conversations

Rank 3 (Tier 1 - simple):
- Combat: "Quick Reflexes" - +1 DEX, +2% melee crit chance
- Crafting: "Efficient Hands" - 15% faster gathering speed
- Social: "Shrewd Bargainer" - 5% discount on vendor purchases, 5% better sell prices

Rank 4 (Tier 2 - moderate):
- Combat: "Bloodthirst" - 3% chance on kill to restore 20% HP
- Crafting: "Prospector's Luck" - 15% chance for rare material drops when gathering
- Social: "Wanderer's Pace" - 20% travel cooldown reduction

Rank 5 (Tier 2 - moderate):
- Combat: "Savage Strikes" - 5% chance on crit to deal 150% bonus damage as a burst
- Crafting: "Master Harvester" - 20% double gather chance + 10% faster gathering
- Social: "Silver Tongue" - +25% NPC affinity gain, +5% vendor discounts

Rank 6 (Tier 2 - moderate, first actives):
- Combat: "Second Wind" (active) - Restore 20% max HP, 5 min cooldown
- Crafting: "Artisan's Touch" - +15% craft quality bonus on all crafted items
- Social: "Fortune's Favor" - +10% gold from all sources, +5% XP bonus

Rank 7 (Tier 3 - complex):
- Combat: "Vampiric Strikes" - 5% on-hit chance to heal for 30% of damage dealt
- Crafting: "Bountiful Harvest" - 25% double gather, 5% rare material chance
- Social: "Diplomat's Grace" - +30% NPC affinity gain, 25% travel cooldown reduction

Rank 8 (Tier 3 - complex):
- Combat: "Thunderous Blow" (active) - Deal 300% weapon damage to target, 5 min cooldown
- Crafting: "Resourceful" - 20% double gather + 20% faster gathering + 10% craft quality
- Social: "Merchant Prince" - 10% vendor discount + 10% better sell prices + 10% gold find

Rank 9 (Tier 3 - complex, scaling):
- Combat: "Deathbringer" - 8% on-kill chance to deal 200% weapon damage to all nearby enemies (AoE proc)
- Crafting: "Masterwork" - +25% craft quality, scales with character level (+0.5% per level)
- Social: "Voice of Authority" - +40% NPC affinity, +8% vendor discounts, +8% XP bonus

Rank 10 (Tier 4 - powerful):
- Combat: "Wrath of the Fallen" (active) - +25% all damage for 20 seconds, 10 min cooldown
- Crafting: "Golden Touch" - 30% double gather, 15% rare materials, +15% craft quality
- Social: "Legend's Presence" - +50% NPC affinity, 30% travel cooldown reduction, +15% gold find

Rank 11 (Tier 4 - powerful):
- Combat: "Undying Fury" - 3% on-damage-taken chance to gain +50% damage for 10 seconds
- Crafting: "Grand Artisan" - 35% double gather, 20% rare materials, +25% craft quality, scales +0.5%/level
- Social: "World Shaper" - +15% XP bonus, +15% gold find, +10% vendor both ways, 35% travel CD reduction

**Important:** Use exact numeric values above. These are Claude's discretion per user decision. Keep all existing perks for ranks 12-15 unchanged.
  </action>
  <verify>TypeScript in renown_data.ts compiles without errors. Every rank 2-11 has exactly 3 perks. Every perk has a domain field. PerkEffect type includes all new fields.</verify>
  <done>PerkEffect type extended with proc/crafting/social/scaling fields. 30 perks defined for ranks 2-11 (3 per rank: combat, crafting, social). Ranks 12-15 unchanged. All perks have domain, name, key, type, description, and effect fields.</done>
</task>

<task type="auto">
  <name>Task 2: Sync frontend perk display data in RenownPanel.vue</name>
  <files>src/components/RenownPanel.vue</files>
  <action>
Update the client-side `RENOWN_PERK_POOLS` constant in RenownPanel.vue (around lines 248-319) to match the new backend perk definitions from Task 1.

The frontend perk data is a subset for display purposes — it needs: `key`, `name`, `type`, `description`, and the new `domain` field.

Add the `domain` field to the frontend type: `domain: 'combat' | 'crafting' | 'social'`.

Replace ranks 2-11 perk entries with the new perks matching the backend definitions. Keep ranks 12-15 unchanged.

Add a small visual indicator for domain type — in the perk selection UI, prefix each perk description with a domain tag:
- Combat perks: description starts with "[Combat] "
- Crafting perks: description starts with "[Crafting] "
- Social perks: description starts with "[Social] "

This domain prefix should be added to the `description` field in the frontend data ONLY (not backend) to help players identify perk categories at a glance.

Also add a color indicator for the domain type where perks are displayed:
- Combat: #c55 (red tint)
- Crafting: #5c5 (green tint)
- Social: #55c (blue tint)

Apply as a left border color on the perk option element (border-left: 3px solid {color}).
  </action>
  <verify>Frontend renders perk names matching backend definitions. Domain colors display correctly. Perk selection still functions for existing characters.</verify>
  <done>Frontend perk definitions match backend for ranks 2-11. Domain tags visible in descriptions. Domain color borders on perk options. Ranks 12-15 unchanged.</done>
</task>

</tasks>

<verification>
1. Confirm renown_data.ts compiles: `cd spacetimedb && npx tsc --noEmit` (or equivalent type check)
2. Confirm RENOWN_PERK_POOLS has entries for ranks 2-15 with 3 perks each
3. Confirm every rank 2-11 perk has the `domain` field
4. Confirm frontend RENOWN_PERK_POOLS keys match backend keys for ranks 2-11
5. Confirm ranks 12-15 are unchanged in both backend and frontend
</verification>

<success_criteria>
- PerkEffect type extended with all new fields (proc, crafting, social, scaling)
- 30 perks designed for ranks 2-11 across three domains
- Backend and frontend perk data in sync
- Domain visual indicators in frontend UI
- Existing perk selection flow unbroken
</success_criteria>

<output>
After completion, create `.planning/phases/20-perk-variety-expansion/20-01-SUMMARY.md`
</output>
