# Phase 21.1.1: Hit/Dodge/Parry Active Stats - Context

**Gathered:** 2026-02-20
**Status:** Ready for planning

<domain>
## Phase Boundary

Wire the character table's existing `hitChance`, `dodgeChance`, and `parryChance` derived stats into the combat outcome roll, replacing hardcoded 5% (50n on 1000-scale) values. Parry only applies against melee attacks. Stat-derived avoidance replaces all hardcoded avoidance percentages in `rollAttackOutcome`.

This phase does NOT redesign the stat formulas in `recomputeCharacterDerived` — those values are already computed. It threads them through to the combat roll.

</domain>

<decisions>
## Implementation Decisions

### Stat source
- DEX drives both dodge and parry chance
- Read pre-computed values directly from character table: `character.dodgeChance`, `character.parryChance`, `character.hitChance`
- Do NOT recompute from raw DEX inside `rollAttackOutcome` — `recomputeCharacterDerived` already owns the formula

### Eligibility gating
- Keep `canDodge` and `canParry` boolean parameters in `rollAttackOutcome`
- Caller controls eligibility (stunned target, ranged attack vs. parry restriction, etc.)
- Stat values replace the hardcoded `50n` threshold — boolean gating logic stays

### Parry restriction
- Parry only applies against melee attacks (enforced by caller passing `canParry: false` for ranged)
- No parry against ranged auto-attacks or ranged abilities

### Claude's Discretion
- Opposed roll formula: Claude picks the cleanest approach that fits the existing `rollAttackOutcome` cursor-based structure (e.g., subtract hit bonus from dodge/parry thresholds, or use raw stat values directly)
- Evasion caps: Claude sets reasonable max dodge/parry to prevent untouchable builds — document the cap in the plan
- Miss as outcome: Claude decides whether low hit chance creates a visible "miss" outcome or only modifies the dodge/parry windows

</decisions>

<specifics>
## Specific Ideas

- The existing `rollAttackOutcome` uses a `cursor` accumulation pattern on a 0–999 roll. Stat values should fit into this pattern naturally — dodgeChance/parryChance are already on the character table and likely on a 0–1000 scale (matching the roll)
- The phase insert note mentions "opposed roll" as the mechanism — Claude should implement this as attacker hit bonus suppressing defender avoidance thresholds (most natural fit for cursor pattern)

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope.

</deferred>

---

*Phase: 21.1.1-hit-dodge-parry-active-stats*
*Context gathered: 2026-02-20*
