---
phase: 03.1.2-combat-balance-for-enemies
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - spacetimedb/src/data/combat_scaling.ts
  - spacetimedb/src/data/ability_catalog.ts
autonomous: true

must_haves:
  truths:
    - "Enemy abilities have power ratings and damage types in their metadata"
    - "Enemy-specific scaling constants exist for level-based power calculation"
    - "New enemy ability kinds exist: heal, aoe_damage, buff"
    - "All existing enemy abilities have power budget metadata (power, damageType, splits)"
  artifacts:
    - path: "spacetimedb/src/data/combat_scaling.ts"
      provides: "ENEMY_BASE_POWER and ENEMY_LEVEL_POWER_SCALING constants"
      contains: "ENEMY_BASE_POWER"
    - path: "spacetimedb/src/data/ability_catalog.ts"
      provides: "Extended ENEMY_ABILITIES with power, damageType, budget split metadata, plus new heal/aoe/buff abilities"
      contains: "aoe_damage"
  key_links:
    - from: "spacetimedb/src/data/ability_catalog.ts"
      to: "spacetimedb/src/data/combat_scaling.ts"
      via: "shared constants referenced during execution"
      pattern: "ENEMY_BASE_POWER|ENEMY_LEVEL_POWER_SCALING"
---

<objective>
Add enemy-specific power scaling constants and extend the ENEMY_ABILITIES catalog with power budget metadata for all existing abilities plus new heal, AoE, and buff ability types.

Purpose: Establish the declarative metadata foundation that Plan 02 will use to implement level-based power scaling, power budget splits, damage type routing, and new ability kinds (heal, aoe_damage, buff) in executeEnemyAbility.

Output: Updated combat_scaling.ts with enemy constants, updated ability_catalog.ts with full metadata on all enemy abilities plus new heal/AoE/buff entries.
</objective>

<execution_context>
@C:/Users/Dell/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Dell/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.1.1-combat-balance-part-2/03.1.1-01-SUMMARY.md
@.planning/phases/03.1.2-combat-balance-for-enemies/03.1.2-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add enemy power scaling constants to combat_scaling.ts</name>
  <files>spacetimedb/src/data/combat_scaling.ts</files>
  <action>
Add two new exported constants to combat_scaling.ts, after the existing DEBUFF_POWER_COST_PERCENT constant:

```typescript
/**
 * Enemy base ability power (level 1 baseline)
 * Enemies do NOT have stats — damage is purely level + power rating
 * User decision: enemy ability damage scales by enemy level only
 */
export const ENEMY_BASE_POWER = 10n;

/**
 * Enemy ability power scaling per level
 * Formula: ENEMY_BASE_POWER + (enemyLevel * ENEMY_LEVEL_POWER_SCALING)
 * Level 1 = 15, Level 5 = 35, Level 10 = 60
 */
export const ENEMY_LEVEL_POWER_SCALING = 5n;
```

These constants are used in Plan 02's executeEnemyAbility rewrite. Do NOT modify any existing constants or functions.
  </action>
  <verify>
Run: `grep -c "ENEMY_BASE_POWER\|ENEMY_LEVEL_POWER_SCALING" spacetimedb/src/data/combat_scaling.ts`
Expected: 2 (one definition each)
  </verify>
  <done>ENEMY_BASE_POWER = 10n and ENEMY_LEVEL_POWER_SCALING = 5n exported from combat_scaling.ts</done>
</task>

<task type="auto">
  <name>Task 2: Extend ENEMY_ABILITIES with power budget metadata and add new ability types</name>
  <files>spacetimedb/src/data/ability_catalog.ts</files>
  <action>
This task has two parts: (A) add power/damageType/budget metadata to ALL existing enemy abilities, and (B) add new heal, aoe_damage, and buff abilities.

**Part A: Extend existing abilities**

Add these fields to every existing enemy ability in ENEMY_ABILITIES:
- `power: bigint` — ability-specific power rating (2n-6n range, proportional to current magnitude)
- `damageType: 'physical' | 'magic'` — routes through armor or magic resist mitigation
- For DoT abilities: `dotPowerSplit: number` (0.4-0.6 fraction of power going to DoT)
- For debuff abilities: `debuffPowerCost: number` (0.25-0.35 fraction of power consumed by debuff)

Mapping guidelines for existing abilities (use these damageType assignments):
- Poison/venom/bite/rending abilities: `damageType: 'physical'`
- Ember/fire/cinder/scorching/searing abilities: `damageType: 'magic'`
- Shadow/hex/curse/blight abilities: `damageType: 'magic'`
- Stone/crushing/gore/bleed/rusty abilities: `damageType: 'physical'`
- Bog/marsh/mire abilities: `damageType: 'physical'`

Power rating guidelines (scale with original magnitude):
- magnitude 1n: power 2n
- magnitude 2n: power 3n
- magnitude 3n: power 4n
- magnitude 4n: power 5n

DoT abilities get `dotPowerSplit: 0.5` (50/50 direct/periodic by default).
Debuff abilities get `debuffPowerCost: 0.25` (matching player DEBUFF_POWER_COST_PERCENT).

Example of an extended DoT ability:
```typescript
poison_bite: {
  name: 'Poison Bite',
  castSeconds: 3n,
  cooldownSeconds: 20n,
  kind: 'dot',
  magnitude: 2n,
  rounds: 3n,
  power: 3n,
  damageType: 'physical' as DamageType,
  dotPowerSplit: 0.5,
  aiChance: 50,
  aiWeight: 70,
  aiRandomness: 15,
},
```

Example of an extended debuff ability:
```typescript
sapping_chant: {
  name: 'Sapping Chant',
  castSeconds: 2n,
  cooldownSeconds: 20n,
  kind: 'debuff',
  effectType: 'ac_bonus',
  magnitude: -2n,
  rounds: 3n,
  power: 3n,
  damageType: 'physical' as DamageType,
  debuffPowerCost: 0.25,
  aiChance: 45,
  aiWeight: 60,
  aiRandomness: 20,
},
```

**Part B: Add new ability types**

Add these new abilities to ENEMY_ABILITIES at the end of the object:

Healing abilities (for enemy healer types):
```typescript
shaman_heal: {
  name: 'Shaman Heal',
  castSeconds: 2n,
  cooldownSeconds: 15n,
  kind: 'heal',
  power: 5n,
  healPowerSplit: 0.6,
  hotDuration: 3n,
  targetRule: 'lowest_hp',
  aiChance: 70,
  aiWeight: 80,
  aiRandomness: 10,
},
dark_mend: {
  name: 'Dark Mend',
  castSeconds: 3n,
  cooldownSeconds: 20n,
  kind: 'heal',
  power: 6n,
  healPowerSplit: 0.5,
  hotDuration: 2n,
  targetRule: 'lowest_hp',
  aiChance: 65,
  aiWeight: 75,
  aiRandomness: 10,
},
```

AoE damage abilities (direct damage only per user decision, NO DoT on AoE):
```typescript
flame_burst: {
  name: 'Flame Burst',
  castSeconds: 2n,
  cooldownSeconds: 20n,
  kind: 'aoe_damage',
  power: 6n,
  damageType: 'magic' as DamageType,
  aiChance: 50,
  aiWeight: 75,
  aiRandomness: 15,
},
quake_wave: {
  name: 'Quake Wave',
  castSeconds: 3n,
  cooldownSeconds: 25n,
  kind: 'aoe_damage',
  power: 7n,
  damageType: 'physical' as DamageType,
  aiChance: 45,
  aiWeight: 70,
  aiRandomness: 15,
},
```

Buff abilities (for enemy support types):
```typescript
warchief_rally: {
  name: 'Warchief Rally',
  castSeconds: 2n,
  cooldownSeconds: 30n,
  kind: 'buff',
  effectType: 'damage_bonus',
  magnitude: 3n,
  rounds: 5n,
  targetRule: 'all_allies',
  aiChance: 60,
  aiWeight: 70,
  aiRandomness: 15,
},
bolster_defenses: {
  name: 'Bolster Defenses',
  castSeconds: 2n,
  cooldownSeconds: 25n,
  kind: 'buff',
  effectType: 'armor_up',
  magnitude: 3n,
  rounds: 4n,
  targetRule: 'all_allies',
  aiChance: 55,
  aiWeight: 65,
  aiRandomness: 15,
},
```

Make sure the DamageType type is available. If not already imported, add `type DamageType = 'physical' | 'magic' | 'none';` at the top of the ENEMY_ABILITIES section or use inline `as DamageType` casts if the type already exists from the ABILITIES section.
  </action>
  <verify>
Run the following checks:
- `grep -c "kind: 'heal'" spacetimedb/src/data/ability_catalog.ts` — expected: 2
- `grep -c "kind: 'aoe_damage'" spacetimedb/src/data/ability_catalog.ts` — expected: 2
- `grep -c "kind: 'buff'" spacetimedb/src/data/ability_catalog.ts` — expected: 2
- `grep -c "dotPowerSplit" spacetimedb/src/data/ability_catalog.ts` — expected: at least 15 (all DoT abilities)
- `grep -c "damageType" spacetimedb/src/data/ability_catalog.ts` — expected: at least 30 (all enemy abilities with damageType)
  </verify>
  <done>All existing enemy abilities annotated with power, damageType, and budget split metadata. Six new abilities added: 2 heal (shaman_heal, dark_mend), 2 aoe_damage (flame_burst, quake_wave), 2 buff (warchief_rally, bolster_defenses)</done>
</task>

</tasks>

<verification>
- combat_scaling.ts exports ENEMY_BASE_POWER (10n) and ENEMY_LEVEL_POWER_SCALING (5n)
- All ~30 existing enemy abilities in ENEMY_ABILITIES have power and damageType fields
- All DoT abilities have dotPowerSplit field
- All debuff abilities have debuffPowerCost field
- 6 new abilities exist: 2 heal, 2 aoe_damage, 2 buff
- AoE abilities have NO dotPowerSplit (per user decision: enemy AoE cannot apply DoTs)
- No TypeScript compilation errors in the data files
</verification>

<success_criteria>
- ENEMY_BASE_POWER and ENEMY_LEVEL_POWER_SCALING constants are exported
- Every ENEMY_ABILITIES entry has power (bigint) and damageType ('physical'|'magic') fields
- DoT abilities have dotPowerSplit (0.4-0.6)
- Debuff abilities have debuffPowerCost (0.25-0.35)
- New heal abilities have healPowerSplit and hotDuration
- New AoE abilities have kind='aoe_damage' and damageType, NO dotPowerSplit
- New buff abilities have kind='buff', effectType, magnitude, rounds, targetRule
</success_criteria>

<output>
After completion, create `.planning/phases/03.1.2-combat-balance-for-enemies/03.1.2-01-SUMMARY.md`
</output>
