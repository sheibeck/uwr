import type { DamageType } from '../ability_catalog.js';

export const ENEMY_ABILITIES = {
  // DoT abilities - physical damage
  poison_bite: {
    name: 'Poison Bite',
    description: 'Venom courses through the wound.',
    castSeconds: 3n,
    cooldownSeconds: 20n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 3n,
    power: 3n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 70,
    aiRandomness: 15,
  },
  rending_bite: {
    name: 'Rending Bite',
    description: 'Flesh tears and bleeds freely.',
    castSeconds: 1n,
    cooldownSeconds: 12n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 2n,
    power: 3n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 60,
    aiWeight: 55,
    aiRandomness: 15,
  },
  bleeding_shot: {
    name: 'Bleeding Shot',
    description: 'Barbed tip lodges in the wound, drawing blood.',
    castSeconds: 1n,
    cooldownSeconds: 15n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 2n,
    power: 4n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 60,
    aiRandomness: 15,
  },
  bog_slime: {
    name: 'Bog Slime',
    description: 'Caustic muck clings and keeps burning.',
    castSeconds: 1n,
    cooldownSeconds: 12n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 2n,
    power: 3n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 50,
    aiRandomness: 15,
  },
  quick_nip: {
    name: 'Quick Nip',
    description: 'Blood seeps from the shallow bite.',
    castSeconds: 1n,
    cooldownSeconds: 10n,
    kind: 'dot',
    magnitude: 1n,
    rounds: 2n,
    power: 2n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 60,
    aiWeight: 45,
    aiRandomness: 20,
  },
  thorn_venom: {
    name: 'Thorn Venom',
    description: 'Toxin spreads from the puncture, searing within.',
    castSeconds: 2n,
    cooldownSeconds: 16n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 3n,
    power: 3n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 60,
    aiRandomness: 15,
  },
  blood_drain: {
    name: 'Blood Drain',
    description: 'Blood drains in slow, dark pulses.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 3n,
    power: 4n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 65,
    aiRandomness: 15,
  },
  rusty_bleed: {
    name: 'Rusty Bleed',
    description: 'Ragged wound refuses to close.',
    castSeconds: 1n,
    cooldownSeconds: 12n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 2n,
    power: 3n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 55,
    aiRandomness: 15,
  },
  stone_cleave: {
    name: 'Stone Cleave',
    description: 'Bone-deep gash bleeds with each breath.',
    castSeconds: 1n,
    cooldownSeconds: 14n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 2n,
    power: 4n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 60,
    aiRandomness: 15,
  },

  // DoT abilities - magic damage
  ember_burn: {
    name: 'Ember Burn',
    description: 'Embers cling to flesh and keep burning.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 65,
    aiRandomness: 15,
  },
  shadow_rend: {
    name: 'Shadow Rend',
    description: 'Shadow cuts linger, gnawing at flesh and spirit.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'dot',
    magnitude: 4n,
    rounds: 3n,
    power: 5n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 70,
    aiRandomness: 15,
  },
  scorching_snap: {
    name: 'Scorching Snap',
    description: 'Smoldering welts pulse with residual heat.',
    castSeconds: 1n,
    cooldownSeconds: 14n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 3n,
    power: 3n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 60,
    aiRandomness: 15,
  },
  ember_spark: {
    name: 'Ember Spark',
    description: 'Sparks burrow beneath the skin and smolder.',
    castSeconds: 1n,
    cooldownSeconds: 12n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 2n,
    power: 3n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 50,
    aiRandomness: 15,
  },
  searing_talon: {
    name: 'Searing Talon',
    description: 'Glowing furrows sear with each passing moment.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 60,
    aiRandomness: 15,
  },
  shadow_bleed: {
    name: 'Shadow Bleed',
    description: 'Blood blackens as shadow seeps into the wound.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 65,
    aiRandomness: 15,
  },
  cinder_blight: {
    name: 'Cinder Blight',
    description: 'Ash fills the lungs and char spreads outward.',
    castSeconds: 2n,
    cooldownSeconds: 16n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 3n,
    power: 3n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 55,
    aiRandomness: 15,
  },
  molten_bleed: {
    name: 'Molten Bleed',
    description: 'Liquid fire courses through the wound, cauterizing nothing.',
    castSeconds: 3n,
    cooldownSeconds: 20n,
    kind: 'dot',
    magnitude: 4n,
    rounds: 3n,
    power: 5n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 70,
    aiRandomness: 15,
  },

  // Debuff abilities - physical damage
  crushing_gore: {
    name: 'Crushing Gore',
    description: 'Your armor buckles from the impact.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -2n,
    rounds: 3n,
    power: 3n,
    damageType: 'physical' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 60,
    aiRandomness: 20,
  },
  quake_stomp: {
    name: 'Quake Stomp',
    description: 'Balance shatters as the ground lurches underfoot.',
    castSeconds: 2n,
    cooldownSeconds: 22n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -3n,
    rounds: 3n,
    power: 4n,
    damageType: 'physical' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 65,
    aiRandomness: 20,
  },

  // Debuff abilities - magic damage
  sapping_chant: {
    name: 'Sapping Chant',
    description: 'Limbs grow heavy as vitality drains away.',
    castSeconds: 2n,
    cooldownSeconds: 20n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -2n,
    rounds: 3n,
    power: 3n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 60,
    aiRandomness: 20,
  },
  withering_hex: {
    name: 'Withering Hex',
    description: 'Cursed sigils eat into armor, stripping its ward.',
    castSeconds: 2n,
    cooldownSeconds: 20n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 65,
    aiRandomness: 20,
  },
  mire_curse: {
    name: 'Mire Curse',
    description: 'Swamp magic seeps into joints, corroding armor.',
    castSeconds: 2n,
    cooldownSeconds: 20n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 60,
    aiRandomness: 20,
  },
  ember_slam: {
    name: 'Ember Slam',
    description: 'Defenses buckle under the concussive heat.',
    castSeconds: 2n,
    cooldownSeconds: 20n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 65,
    aiRandomness: 20,
  },
  chill_touch: {
    name: 'Chill Touch',
    description: 'Cold brittles armor and numbs your guard.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -2n,
    rounds: 3n,
    power: 3n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 60,
    aiRandomness: 20,
  },
  grave_shield_break: {
    name: 'Grave Shield Break',
    description: 'Necrotic energy unravels protective enchantments.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -2n,
    rounds: 3n,
    power: 3n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 60,
    aiRandomness: 20,
  },
  vault_crush: {
    name: 'Vault Crush',
    description: 'Stone magic grinds defenses to dust.',
    castSeconds: 2n,
    cooldownSeconds: 20n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 70,
    aiRandomness: 20,
  },
  soot_hex: {
    name: 'Soot Hex',
    description: 'Black soot chokes and weakens exposed flesh.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -2n,
    rounds: 3n,
    power: 3n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 60,
    aiRandomness: 20,
  },

  // Heal abilities (new)
  shaman_heal: {
    name: 'Shaman Heal',
    description: 'Torn flesh knits together with a sickly glow.',
    castSeconds: 2n,
    cooldownSeconds: 15n,
    kind: 'heal',
    power: 5n,
    healPowerSplit: 0.6,
    hotDuration: 3n,
    targetRule: 'lowest_hp',
    aiChance: 70,
    aiWeight: 80,
    aiRandomness: 10,
  },
  dark_mend: {
    name: 'Dark Mend',
    description: 'Wounds stitch shut with unnatural dark energy.',
    castSeconds: 3n,
    cooldownSeconds: 20n,
    kind: 'heal',
    power: 6n,
    healPowerSplit: 0.5,
    hotDuration: 2n,
    targetRule: 'lowest_hp',
    aiChance: 65,
    aiWeight: 75,
    aiRandomness: 10,
  },

  // AoE damage abilities (new)
  flame_burst: {
    name: 'Flame Burst',
    description: 'Fire erupts across the field, scorching all in range.',
    castSeconds: 2n,
    cooldownSeconds: 20n,
    kind: 'aoe_damage',
    power: 6n,
    damageType: 'magic' as DamageType,
    targetRule: 'all_players',
    aiChance: 50,
    aiWeight: 75,
    aiRandomness: 15,
  },
  quake_wave: {
    name: 'Quake Wave',
    description: 'Shockwaves ripple outward, battering everyone who stands.',
    castSeconds: 3n,
    cooldownSeconds: 25n,
    kind: 'aoe_damage',
    power: 7n,
    damageType: 'physical' as DamageType,
    targetRule: 'all_players',
    aiChance: 45,
    aiWeight: 70,
    aiRandomness: 15,
  },

  // Night enemy abilities (quick-170)
  moth_dust: {
    name: 'Moth Dust',
    description: 'Scales irritate exposed skin and keep stinging.',
    castSeconds: 1n,
    cooldownSeconds: 12n,
    kind: 'dot',
    magnitude: 1n,
    rounds: 2n,
    power: 2n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 45,
    aiRandomness: 20,
  },
  plague_bite: {
    name: 'Plague Bite',
    description: 'Filth spreads through the bloodstream from the bite.',
    castSeconds: 1n,
    cooldownSeconds: 12n,
    kind: 'dot',
    magnitude: 1n,
    rounds: 2n,
    power: 2n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 50,
    aiRandomness: 20,
  },
  spectral_flame: {
    name: 'Spectral Flame',
    description: 'Ghostly fire sears the soul without giving warmth.',
    castSeconds: 2n,
    cooldownSeconds: 16n,
    kind: 'dot',
    magnitude: 2n,
    rounds: 3n,
    power: 3n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 55,
    aiRandomness: 15,
  },
  shadow_pounce: {
    name: 'Shadow Pounce',
    description: 'Claws rake deep, leaving wounds that keep bleeding.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 2n,
    power: 4n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 60,
    aiRandomness: 15,
  },
  drowning_grasp: {
    name: 'Drowning Grasp',
    description: 'Lungs fill with phantom water, each breath a struggle.',
    castSeconds: 2n,
    cooldownSeconds: 18n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 60,
    aiRandomness: 15,
  },
  soul_rend: {
    name: 'Soul Rend',
    description: 'Life force frays at the edges, bleeding away.',
    castSeconds: 2n,
    cooldownSeconds: 20n,
    kind: 'dot',
    magnitude: 3n,
    rounds: 3n,
    power: 4n,
    damageType: 'magic' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 50,
    aiWeight: 65,
    aiRandomness: 15,
  },
  venom_fang: {
    name: 'Venom Fang',
    description: 'Burning venom spreads quickly through the bloodstream.',
    castSeconds: 1n,
    cooldownSeconds: 12n,
    kind: 'dot',
    magnitude: 1n,
    rounds: 2n,
    power: 2n,
    damageType: 'physical' as DamageType,
    dotPowerSplit: 0.5,
    targetRule: 'aggro',
    aiChance: 55,
    aiWeight: 50,
    aiRandomness: 20,
  },
  sonic_screech: {
    name: 'Sonic Screech',
    description: 'Bone-rattling shriek loosens armor and staggers the guard.',
    castSeconds: 1n,
    cooldownSeconds: 14n,
    kind: 'debuff',
    effectType: 'ac_bonus',
    magnitude: -2n,
    rounds: 3n,
    power: 3n,
    damageType: 'magic' as DamageType,
    debuffPowerCost: 0.25,
    targetRule: 'aggro',
    aiChance: 45,
    aiWeight: 55,
    aiRandomness: 20,
  },

  // Buff abilities (new)
  warchief_rally: {
    name: 'Warchief Rally',
    description: 'War cry ignites fury in every ally nearby.',
    castSeconds: 2n,
    cooldownSeconds: 30n,
    kind: 'buff',
    effectType: 'damage_bonus',
    magnitude: 3n,
    rounds: 5n,
    targetRule: 'all_allies',
    aiChance: 60,
    aiWeight: 70,
    aiRandomness: 15,
  },
  bolster_defenses: {
    name: 'Bolster Defenses',
    description: 'Scales harden and hides thicken across the pack.',
    castSeconds: 2n,
    cooldownSeconds: 25n,
    kind: 'buff',
    effectType: 'armor_up',
    magnitude: 3n,
    rounds: 4n,
    targetRule: 'all_allies',
    aiChance: 55,
    aiWeight: 65,
    aiRandomness: 15,
  },
};

// Maps enemy template names to their ability keys.
// This is the single source of truth for which enemies have which abilities.
// Adding a new enemy ability requires: (1) add entry to ENEMY_ABILITIES above,
// (2) add template mapping here — both in this same file.
//
// Design notes:
//   - Basic creatures (rats, wolves, frogs, etc.) have NO abilities — they auto-attack only.
//   - Thematic DoTs: only enemies where a DoT makes narrative sense (leech, wisp, venom snake…).
//   - Warrior/fighter types use debuffs rather than DoTs — a heavy blow cracks armor.
//   - Spellcasters and special enemies may have 2 abilities for variety.
export const ENEMY_TEMPLATE_ABILITIES: Record<string, string[]> = {
  // --- Basic creatures: auto-attack only, no abilities ---
  // Bog Rat, Thicket Wolf, Marsh Croaker, Dust Hare, Emberling,
  // Dusk Moth, Night Rat, Gloomwing Bat → omitted intentionally

  // --- Thematic DoT enemies ---
  'Ember Wisp':          ['ember_burn'],       // fire wisp, pure magic burn
  'Bandit':              ['bleeding_shot'],     // archer landing a bleeding wound
  'Blight Stalker':      ['shadow_rend'],       // dark creature, magic blight DoT
  'Ash Jackal':          ['scorching_snap'],    // fire-touched jackal bite
  'Thorn Sprite':        ['thorn_venom'],       // nature creature, poison DoT
  'Mire Leech':          ['blood_drain'],       // leech — blood drain is the whole point
  'Emberhawk':           ['searing_talon'],     // fire hawk, burning talon DoT
  'Alley Shade':         ['shadow_bleed'],      // shadow creature, magic bleed
  'Sootbound Mystic':    ['soot_hex', 'bolster_defenses'],  // mystic DoT + buff
  'Ember Priest':        ['cinder_blight'],     // fire mage DoT
  'Ashforged Revenant':  ['molten_bleed'],      // fire undead, molten blood DoT

  // --- Debuff enemies (fighter/warrior types that hit hard) ---
  'Gloom Stag':          ['crushing_gore'],     // charging stag, powerful debuff strike
  'Grave Skirmisher':    ['crushing_gore'],     // undead warrior, punishing blow
  'Ridge Skirmisher':    ['quake_stomp'],       // heavy stone fighter, quake debuff
  'Frostbone Acolyte':   ['chill_touch'],       // undead mage, chilling debuff
  'Grave Servant':       ['grave_shield_break'],// undead with shield-shattering strike
  'Vault Sentinel':      ['vault_crush'],       // heavy guardian, crushing debuff

  // --- Mixed ability enemies (spellcasters and elites) ---
  'Grave Acolyte':       ['sapping_chant', 'dark_mend'],     // undead mage: debuff + self-heal
  'Hexbinder':           ['withering_hex', 'warchief_rally'],// humanoid mage: debuff + group buff
  'Fen Witch':           ['mire_curse', 'shaman_heal'],      // witch: debuff + heal
  'Cinder Sentinel':     ['ember_slam', 'flame_burst'],      // elite: debuff + AoE
  'Basalt Brute':        ['quake_stomp', 'quake_wave'],      // elite: debuff + AoE

  // --- Night enemies ---
  'Cinder Wraith':       ['spectral_flame'],    // fire ghost, magic DoT
  'Shadow Prowler':      ['shadow_pounce'],     // ambush predator, physical DoT
  'Bog Specter':         ['drowning_grasp'],    // bog ghost, magic DoT
  'Ashveil Phantom':     ['soul_rend'],         // phantom, soul DoT
  'Nightfang Viper':     ['venom_fang'],        // snake — venom is entirely on-brand
};
